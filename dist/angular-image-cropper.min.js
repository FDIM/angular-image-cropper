!function(t){"use strict";t.module("imageCropper",[])}(angular),function(t){"use strict";t.module("imageCropper").constant("defaultConfig",{width:400,height:300,zoomStep:.1,onLoad:t.noop,showControls:!0,fitOnInit:!1,croppingDelay:0})}(angular),function(t){"use strict";function e(t){function e(t){return r.test(t.type)}function n(t){return e(t)?1===t.originalEvent.changedTouches.length:1===t.which}function o(t){return e(t)&&(t=t.originalEvent.touches[0]),{x:t.pageX,y:t.pageY}}function i(){if(null!==a)return a;var t,e,n,o,i,r,l,c,u;for(n=["webkit","Moz","O","ms","Khtml"],r={transform:"transform"},c=0,u=n.length;u>c;c++)e=n[c],r[e+"Transform"]="-"+e.toLowerCase()+"-transform";t=document.createElement("img"),document.body.insertBefore(t,null);for(i in r)if(o=r[i],void 0!==t.style[i]&&(t.style[i]="rotate(90deg)",l=window.getComputedStyle(t).getPropertyValue(o),null!==l&&l.length&&"none"!==l)){a=!0;break}return document.body.removeChild(t),a}var r=/touch/i,a=null,l={canTransform:i,getPointerPosition:o,isTouch:e,validEvent:n};return l}t.module("imageCropper").factory("Helper",e),e.$inject=["defaultConfig"]}(angular),function(t){"use strict";function e(t,e){function n(t,n,i,u){return r=document.createElement("canvas"),r.width=i,r.height=u,a=r.getContext("2d"),c=n,s=e.defer(),l=new Image,l.src=t.src,l.onload=o,s.promise}function o(){return a.save(),a.scale(c.scale,c.scale),a.rotate(c.angle*Math.PI/180),90===c.angle?(a.translate(0,-l.height),a.translate(-c.y/c.scale,c.x/c.scale)):180===c.angle?(a.translate(-l.width,-l.height),a.translate(c.x/c.scale,c.y/c.scale)):270===c.angle?(a.translate(-l.width,0),a.translate(c.y/c.scale,-c.x/c.scale)):a.translate(-c.x/c.scale,-c.y/c.scale),a.drawImage(l,0,0),a.restore(),u=r.toDataURL("image/jpeg"),s.resolve(u)}function i(){return u}var r,a,l,c,u,s,g={crop:n,get:i};return g}t.module("imageCropper").factory("Cropper",e),e.$inject=["Helper","$q"]}(angular),function(t){"use strict";function e(e,n,o,i){function r(r,a,l){var c,u=!1,s=t.element("body"),g=a.find("img"),d=a.find(".imgCropper-canvas"),h=a.find(".imgCropper-window"),f={};f.width=Number(r.destWidth)||n.width,f.height=Number(r.destHeight)||n.height,f.zoomStep=Number(r.zoomStep)||n.zoomStep,f.onLoad=r.onLoad||n.onLoad,f.fitOnInit=r.fitOnInit||n.fitOnInit,f.croppingDelay=Number(r.croppingDelay)||n.croppingDelay;var p,m,v,y,w,b=1+f.zoomStep,C=1/b,z=f.height/f.width;p=m=v=y=w=0;var I,x={scale:1,angle:0,x:0,y:0,w:f.width,h:f.height},k={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"},L=function(){p=g[0].naturalWidth/f.width,m=g[0].naturalHeight/f.height,d.css({width:100*p+"%",height:100*m+"%",top:0,left:0}),h.css({width:"100%",height:"auto","padding-top":f.height/f.width*100+"%"}),u=!0},O=function(t){return u&&o.validEvent(t)?(t.preventDefault(),t.stopImmediatePropagation(),I=o.getPointerPosition(t),P()):void 0},P=function(){return s.addClass("imgCropper-dragging"),d.on(k.move,E),d.on(k.stop,D)},D=function(t){s.removeClass("imgCropper-dragging"),d.off(k.move,E),d.off(k.stop,D)},H=function(t,e){return(t||0===t)&&(0>t&&(t=0),t>p-1&&(t=p-1),d[0].style.left=(100*-t).toFixed(2)+"%",v=t,x.x=Math.round(t*f.width)),(e||0===e)&&(0>e&&(e=0),e>m-1&&(e=m-1),d[0].style.top=(100*-e).toFixed(2)+"%",y=e,x.y=Math.round(e*f.height)),$()},E=function(t){var e,n,i,r,a;return t.preventDefault(),t.stopImmediatePropagation(),r=o.getPointerPosition(t),e=r.x-I.x,n=r.y-I.y,I=r,i=0===e?null:v-e/h[0].clientWidth,a=0===n?null:y-n/h[0].clientHeight,H(i,a)},F=function(t){var e,n,o,i;if(!(0>=t||1===t))return i=p,e=m,i*t>1&&e*t>1?(p*=t,m*=t,d[0].style.width=(100*p).toFixed(2)+"%",d[0].style.height=(100*m).toFixed(2)+"%",x.scale*=t):(R(),t=p/i),n=(v+.5)*t-.5,o=(y+.5)*t-.5,H(n,o)},R=function(){var t,e;return t=p,e=m/p,e>1?(p=1,m=e):(p=1/e,m=1),d[0].style.width=(100*p).toFixed(2)+"%",d[0].style.height=(100*m).toFixed(2)+"%",x.scale*=p/t,$()},S=function(){return H((p-1)/2,(m-1)/2)},j=function(t){var e,n,i,r,a,l;if(o.canTransform()&&0!==t&&t%90===0)return w=(w+t)%360,0>w&&(w=360+w),t%180!==0&&(r=[m*z,p/z],p=r[0],m=r[1],p>=1&&m>=1?(d[0].style.width=100*p+"%",d[0].style.height=100*m+"%"):R()),a=[1,1],i=a[0],n=a[1],w%180!==0&&(e=m/p*z,l=[e,1/e],i=l[0],n=l[1]),g[0].style.width=100*i+"%",g[0].style.height=100*n+"%",g[0].style.left=(1-i)/2*100+"%",g[0].style.top=(1-n)/2*100+"%",g.css({transform:"rotate("+w+"deg)"}),S(),x.angle=w,$()};r.rotateLeft=function(){j(-90)},r.rotateRight=function(){j(90)},r.center=function(){S()},r.fit=function(){R(),S()},r.zoomIn=function(){F(b)},r.zoomOut=function(){F(C)};var T={zoomIn:r.zoomIn,zoomOut:r.zoomOut,fit:r.fit,center:r.center,rotateLeft:r.rotateLeft,rotateRight:r.rotateRight,rotate:j},W=function(){e.crop(g[0],x,f.width,f.height).then(function(t){r.croppedImage=t})},$=function(t){f.croppingDelay>0&&!t?(c&&i.cancel(c),c=i(W,1e3)):W()};g[0].onload=function(){var t=this;L(),M(g),(t.naturalWidth<f.width||t.naturalHeight<f.height||f.fitOnInit)&&R(),S(),a.find("img").on(k.start,O),$(!0),f.onLoad(T)};var M=function(e){return t.element(e).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})}}return{restrict:"E",scope:{image:"@",destWidth:"@",destHeight:"@",zoomStep:"@",onLoad:"=",croppedImage:"=",showControls:"=",fitOnInit:"=",croppingDelay:"="},template:['<div class="frame">','<div class="imgCropper-window">','<div class="imgCropper-canvas">','<img ng-src="{{image}}">',"</div></div></div>",'<div class="controls" ng-if="showControls">','<button ng-click="rotateLeft()" class="rotate-left" type="button" title="Rotate left"> &lt; </button>','<button ng-click="zoomOut()" class="zoom-out" type="button" title="Zoom out"> - </button>','<button ng-click="fit()" class="fit" type="button" title="Fit image"> [ ] </button>','<button ng-click="zoomIn()" class="zoom-in" type="button" title="Zoom in"> + </button>','<button ng-click="rotateRight()" class="rotate-right" type="button" title="Rotate right"> &gt; </button>',"</div>"].join(""),link:r}}t.module("imageCropper").directive("imageCropper",e),e.$inject=["Cropper","defaultConfig","Helper","$timeout"]}(angular);