!function(t){"use strict";t.module("imageCropper",[])}(angular),function(t){"use strict";t.module("imageCropper").constant("imageCropperDefaultConfig",{width:400,height:300,zoomStep:.1,onLoad:t.noop,showControls:!0,fitOnInit:!1,autoCrop:!0,autoCropDelay:0})}(angular),function(t){"use strict";function e(t){function e(t){return r.test(t.type)}function o(t){return e(t)?1===t.originalEvent.changedTouches.length:1===t.which}function n(t){return e(t)&&(t=t.originalEvent.touches[0]),{x:t.pageX,y:t.pageY}}function i(){if(null!==a)return a;var t,e,o,n,i,r,u,l,s;for(o=["webkit","Moz","O","ms","Khtml"],r={transform:"transform"},l=0,s=o.length;s>l;l++)e=o[l],r[e+"Transform"]="-"+e.toLowerCase()+"-transform";t=document.createElement("img"),document.body.insertBefore(t,null);for(i in r)if(n=r[i],void 0!==t.style[i]&&(t.style[i]="rotate(90deg)",u=window.getComputedStyle(t).getPropertyValue(n),null!==u&&u.length&&"none"!==u)){a=!0;break}return document.body.removeChild(t),a}var r=/touch/i,a=null,u={canTransform:i,getPointerPosition:n,isTouch:e,validEvent:o};return u}t.module("imageCropper").factory("imageCropperHelper",e),e.$inject=["imageCropperDefaultConfig"]}(angular),function(t){"use strict";function e(t,e){function o(t,o,i,s){return r=document.createElement("canvas"),r.width=i,r.height=s,a=r.getContext("2d"),l=o,c=e.defer(),u=new Image,u.src=t.src,u.onload=n,c.promise}function n(){return a.save(),a.scale(l.scale,l.scale),a.rotate(l.angle*Math.PI/180),90===l.angle?(a.translate(0,-u.height),a.translate(-l.y/l.scale,l.x/l.scale)):180===l.angle?(a.translate(-u.width,-u.height),a.translate(l.x/l.scale,l.y/l.scale)):270===l.angle?(a.translate(-u.width,0),a.translate(l.y/l.scale,-l.x/l.scale)):a.translate(-l.x/l.scale,-l.y/l.scale),a.drawImage(u,0,0),a.restore(),s=r.toDataURL("image/jpeg"),c.resolve(s)}function i(){return s}var r,a,u,l,s,c,g={crop:o,get:i};return g}t.module("imageCropper").factory("imageCropper",e),e.$inject=["imageCropperHelper","$q"]}(angular),function(t){"use strict";function e(e,o,n,i,r){function a(a,u,l){function s(){$=E[0].naturalWidth/R.width,j=E[0].naturalHeight/R.height,F.css({width:100*$+"%",height:100*j+"%",top:0,left:0}),S.css({width:"100%",height:"auto","padding-top":R.height/R.width*100+"%"}),P=!0}function c(t){return P&&n.validEvent(t)?(t.preventDefault(),t.stopImmediatePropagation(),B=n.getPointerPosition(t),g()):void 0}function g(){return u.parent().addClass("imgCropper-dragging"),H.on(U.move,h),H.on(U.stop,p),F}function p(t){return u.parent().removeClass("imgCropper-dragging"),H.off(U.move,h),H.off(U.stop,p),F}function d(t,e){(t||0===t)&&(0>t&&(t=0),t>$-1&&(t=$-1),F[0].style.left=(100*-t).toFixed(2)+"%",T=t,K.x=Math.round(t*R.width)),(e||0===e)&&(0>e&&(e=0),e>j-1&&(e=j-1),F[0].style.top=(100*-e).toFixed(2)+"%",W=e,K.y=Math.round(e*R.height)),R.autoCrop&&D()}function h(t){var e,o,i,r,a;return t.preventDefault(),t.stopImmediatePropagation(),r=n.getPointerPosition(t),e=r.x-B.x,o=r.y-B.y,B=r,i=0===e?null:T-e/S[0].clientWidth,a=0===o?null:W-o/S[0].clientHeight,d(i,a)}function m(t){var e,o,n,i;if(!(0>=t||1===t))return i=$,e=j,i*t>1&&e*t>1?($*=t,j*=t,F[0].style.width=(100*$).toFixed(2)+"%",F[0].style.height=(100*j).toFixed(2)+"%",K.scale*=t):(f(),t=$/i),o=(T+.5)*t-.5,n=(W+.5)*t-.5,d(o,n)}function f(){var t,e;t=$,e=j/$,e>1?($=1,j=e):($=1/e,j=1),F[0].style.width=(100*$).toFixed(2)+"%",F[0].style.height=(100*j).toFixed(2)+"%",K.scale*=$/t,R.autoCrop&&D()}function v(){return d(($-1)/2,(j-1)/2)}function C(t){var e,o,i,r,a,u;n.canTransform()&&0!==t&&t%90===0&&(M=(M+t)%360,0>M&&(M=360+M),t%180!==0&&(r=[j*Z,$/Z],$=r[0],j=r[1],$>=1&&j>=1?(F[0].style.width=100*$+"%",F[0].style.height=100*j+"%"):f()),a=[1,1],i=a[0],o=a[1],M%180!==0&&(e=j/$*Z,u=[e,1/e],i=u[0],o=u[1]),E[0].style.width=100*i+"%",E[0].style.height=100*o+"%",E[0].style.left=(1-i)/2*100+"%",E[0].style.top=(1-o)/2*100+"%",E.css({transform:"rotate("+M+"deg)"}),v(),K.angle=M,R.autoCrop&&D())}function y(){C(-90)}function w(){C(90)}function b(){f(),v()}function x(){m(N)}function I(){m(q)}function z(){return e.crop(E[0],K,R.width,R.height).then(function(t){return a.croppedImage=t,t})}function D(t){return r(function(e,o){R.autoCropDelay>0&&!t?(O&&i.cancel(O),O=i(z,R.autoCropDelay),e(O)):e(z())})}function k(){var t=E[0];s(),L(E),(t.naturalWidth<R.width||t.naturalHeight<R.height||R.fitOnInit)&&f(),v(),u.find("img").on(U.start,c),R.autoCrop&&D(!0),R.onLoad(V)}function L(e){return t.element(e).css({"-webkit-perspective":1e3,perspective:1e3,"-webkit-backface-visibility":"hidden","backface-visibility":"hidden"})}var O,P=!1,H=t.element("body"),E=u.find("img"),F=u.find(".imgCropper-canvas"),S=u.find(".imgCropper-window"),R={};R.width=Number(a.destWidth)||o.width,R.height=Number(a.destHeight)||o.height,R.zoomStep=Number(a.zoomStep)||o.zoomStep,R.onLoad=a.onLoad||o.onLoad,R.fitOnInit=a.fitOnInit||o.fitOnInit,R.autoCrop=a.autoCrop?!0:!1,R.autoCropDelay=Number(a.autoCropDelay)||o.autoCropDelay;var $,j,T,W,M,N=1+R.zoomStep,q=1/N,Z=R.height/R.width;$=j=T=W=M=0;var B,K={scale:1,angle:0,x:0,y:0,w:R.width,h:R.height},U={start:"touchstart mousedown",move:"touchmove mousemove",stop:"touchend mouseup"};a.rotateLeft=y,a.rotateRight=w,a.center=v,a.fit=b,a.zoomIn=x,a.zoomOut=I;var V={zoomIn:x,zoomOut:I,fit:b,center:a.center,rotateLeft:y,rotateRight:w,rotate:C,crop:z};E[0].onload=k}return{restrict:"E",scope:{image:"=",destWidth:"@",destHeight:"@",zoomStep:"@",onLoad:"=",croppedImage:"=",showControls:"=",fitOnInit:"=",autoCrop:"=",autoCropDelay:"="},template:['<div class="frame">','<div class="imgCropper-window">','<div class="imgCropper-canvas">','<img ng-src="{{image}}">',"</div></div></div>",'<div class="controls" ng-if="showControls">','<button ng-click="rotateLeft()" class="rotate-left" type="button" title="Rotate left"> &lt; </button>','<button ng-click="zoomOut()" class="zoom-out" type="button" title="Zoom out"> - </button>','<button ng-click="fit()" class="fit" type="button" title="Fit image"> [ ] </button>','<button ng-click="zoomIn()" class="zoom-in" type="button" title="Zoom in"> + </button>','<button ng-click="rotateRight()" class="rotate-right" type="button" title="Rotate right"> &gt; </button>',"</div>"].join(""),link:a}}t.module("imageCropper").directive("imageCropper",e),e.$inject=["imageCropper","imageCropperDefaultConfig","imageCropperHelper","$timeout","$q"]}(angular);